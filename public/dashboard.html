<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FleetForce Enterprise | Unified Command Center</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        :root {
            --primary: #0F172A;
            --accent: #3B82F6;
            --success: #10B981;
            --warning: #F59E0B;
            --danger: #EF4444;
            --text-primary: #FFFFFF;
            --text-secondary: #94A3B8;
            --text-muted: #64748B;
            --bg-dark: #0B1120;
            --bg-card: #1E293B;
            --bg-hover: #374151;
            --border: #374151;
            --gradient-hero: linear-gradient(135deg, #1e3a8a 0%, #3730a3 50%, #581c87 100%);
            --gradient-card: linear-gradient(145deg, #1E293B 0%, #2D3748 100%);
            --shadow-lg: 0 16px 32px rgba(0, 0, 0, 0.2);
            --shadow-xl: 0 24px 48px rgba(0, 0, 0, 0.25);
        }
        
        body {
            font-family: 'Inter', system-ui, sans-serif;
            background: var(--bg-dark);
            color: var(--text-primary);
            line-height: 1.6;
            -webkit-font-smoothing: antialiased;
        }
        
        body::before {
            content: '';
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: 
                radial-gradient(circle at 25% 25%, rgba(59, 130, 246, 0.08) 0%, transparent 50%),
                radial-gradient(circle at 75% 75%, rgba(139, 92, 246, 0.08) 0%, transparent 50%),
                linear-gradient(135deg, #0B1120 0%, #1E293B 100%);
            z-index: -1;
        }
        
        .top-header {
            background: rgba(15, 23, 42, 0.95);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(59, 130, 246, 0.2);
            padding: 1.25rem 2rem;
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: var(--shadow-lg);
        }
        
        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .brand {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .logo {
            width: 52px; height: 52px;
            background: var(--gradient-hero);
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 26px;
            font-weight: 800;
            color: white;
            box-shadow: 0 8px 32px rgba(59, 130, 246, 0.4);
        }
        
        .brand-text h1 {
            font-size: 1.875rem;
            font-weight: 800;
            background: linear-gradient(135deg, #3B82F6 0%, #8B5CF6 50%, #06B6D4 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin: 0;
        }
        
        .brand-text p {
            font-size: 0.875rem;
            color: var(--text-secondary);
            margin: 0;
            font-weight: 500;
        }
        
        .header-actions {
            display: flex;
            align-items: center;
            gap: 1.5rem;
        }
        
        .status-indicator {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem 1.25rem;
            background: rgba(16, 185, 129, 0.1);
            border: 1px solid rgba(16, 185, 129, 0.3);
            border-radius: 100px;
            font-size: 0.875rem;
            color: var(--success);
            font-weight: 600;
        }
        
        .pulse {
            width: 10px; height: 10px;
            background: var(--success);
            border-radius: 50%;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.7; transform: scale(1.2); }
            100% { opacity: 1; transform: scale(1); }
        }
        
        .current-time {
            font-size: 0.875rem;
            color: var(--text-secondary);
            font-weight: 500;
            font-variant-numeric: tabular-nums;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
        }
        
        .nav-container {
            background: var(--gradient-card);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 1rem;
            margin-bottom: 2rem;
            box-shadow: var(--shadow-lg);
        }
        
        .nav-tabs {
            display: flex;
            gap: 0.5rem;
            overflow-x: auto;
        }
        
        .nav-tab {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 1rem 1.5rem;
            border: none;
            background: transparent;
            color: var(--text-secondary);
            font-size: 0.875rem;
            font-weight: 600;
            cursor: pointer;
            border-radius: 14px;
            transition: all 0.3s ease;
            white-space: nowrap;
        }
        
        .nav-tab:hover {
            color: var(--text-primary);
            background: var(--bg-hover);
        }
        
        .nav-tab.active {
            color: white;
            background: var(--gradient-hero);
            box-shadow: 0 0 20px rgba(59, 130, 246, 0.3);
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* Dashboard-specific styles */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            margin-bottom: 2rem;
        }
        
        .stat-card {
            background: var(--gradient-card);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 2rem;
            transition: all 0.3s ease;
        }
        
        .stat-card:hover {
            transform: translateY(-8px);
            box-shadow: var(--shadow-xl);
            border-color: rgba(59, 130, 246, 0.4);
        }
        
        .stat-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 1.5rem;
        }
        
        .stat-icon {
            width: 56px; height: 56px;
            background: rgba(59, 130, 246, 0.1);
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
        }
        
        .stat-trend {
            padding: 0.5rem 1rem;
            border-radius: 100px;
            font-size: 0.875rem;
            font-weight: 700;
            color: var(--success);
            background: rgba(16, 185, 129, 0.15);
            border: 1px solid rgba(16, 185, 129, 0.3);
        }
        
        .stat-value {
            font-size: 3rem;
            font-weight: 800;
            color: var(--text-primary);
            line-height: 1;
            margin-bottom: 0.75rem;
        }
        
        .stat-label {
            font-size: 0.875rem;
            color: var(--text-secondary);
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.075em;
        }
        
        .stat-sublabel {
            font-size: 0.75rem;
            color: var(--text-muted);
            font-weight: 500;
            margin-top: 0.25rem;
        }
        
        /* Activity Feed */
        .dashboard-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 2rem;
        }
        
        .activity-section {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 16px;
            overflow: hidden;
        }
        
        .section-header {
            padding: 1.5rem;
            background: rgba(15, 23, 42, 0.5);
            backdrop-filter: blur(10px);
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--border);
        }
        
        .section-title {
            font-size: 1.125rem;
            font-weight: 600;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        
        .activity-list {
            max-height: 600px;
            overflow-y: auto;
        }
        
        .activity-item {
            padding: 1.5rem;
            border-bottom: 1px solid var(--border);
            transition: all 0.2s ease;
        }
        
        .activity-item:hover {
            background: var(--bg-hover);
        }
        
        .activity-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 1rem;
        }
        
        .activity-info {
            flex: 1;
        }
        
        .activity-driver {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.25rem;
            font-size: 1rem;
        }
        
        .activity-details {
            display: flex;
            gap: 1rem;
            font-size: 0.875rem;
            color: var(--text-secondary);
            flex-wrap: wrap;
        }
        
        .status-badge {
            padding: 0.375rem 0.875rem;
            border-radius: 100px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        
        .status-active {
            background: rgba(16, 185, 129, 0.1);
            color: var(--success);
            border: 1px solid rgba(16, 185, 129, 0.3);
        }
        
        .status-standby {
            background: rgba(100, 116, 139, 0.1);
            color: var(--text-muted);
            border: 1px solid rgba(100, 116, 139, 0.3);
        }
        
        /* Admin panel styles */
        .card {
            background: var(--gradient-card);
            border: 1px solid var(--border);
            border-radius: 24px;
            padding: 2.5rem;
            box-shadow: var(--shadow-xl);
            margin-bottom: 2rem;
        }
        
        .card:hover {
            transform: translateY(-4px);
            border-color: rgba(59, 130, 246, 0.3);
        }
        
        .card-title {
            font-size: 1.75rem;
            font-weight: 700;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 1rem;
            margin: 0 0 2rem 0;
        }
        
        .card-subtitle {
            font-size: 0.875rem;
            color: var(--text-secondary);
            margin-top: 0.5rem;
            font-weight: 500;
        }
        
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            margin-bottom: 2rem;
        }
        
        .form-group {
            margin-bottom: 1.5rem;
        }
        
        .form-label {
            display: block;
            font-size: 0.875rem;
            color: var(--text-secondary);
            margin-bottom: 0.75rem;
            font-weight: 600;
        }
        
        .form-input, .form-select {
            width: 100%;
            padding: 1rem 1.25rem;
            background: rgba(15, 23, 42, 0.8);
            border: 1px solid var(--border);
            border-radius: 12px;
            color: var(--text-primary);
            font-size: 0.875rem;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        
        .form-input:focus, .form-select:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.1);
        }
        
        .btn {
            display: inline-flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.875rem 1.75rem;
            border: none;
            border-radius: 12px;
            font-size: 0.875rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            margin-right: 0.75rem;
            margin-bottom: 0.75rem;
        }
        
        .btn-primary {
            background: var(--gradient-hero);
            color: white;
            box-shadow: 0 0 20px rgba(59, 130, 246, 0.3);
        }
        
        .btn-primary:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 0 30px rgba(59, 130, 246, 0.4);
        }
        
        .btn-secondary {
            background: #374151;
            color: var(--text-primary);
            border: 1px solid var(--border);
        }
        
        .btn-secondary:hover:not(:disabled) {
            background: var(--bg-hover);
            transform: translateY(-2px);
        }
        
        .btn-success {
            background: linear-gradient(135deg, #10B981 0%, #059669 100%);
            color: white;
            box-shadow: 0 0 20px rgba(16, 185, 129, 0.3);
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #EF4444 0%, #DC2626 100%);
            color: white;
            box-shadow: 0 0 20px rgba(239, 68, 68, 0.3);
        }
        
        .loading-spinner {
            display: none;
            width: 18px; height: 18px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s linear infinite;
        }
        
        .btn.loading .loading-spinner {
            display: inline-block;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .users-list {
            max-height: 600px;
            overflow-y: auto;
        }
        
        .user-item {
            background: var(--gradient-card);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 1.75rem;
            margin-bottom: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
        }
        
        .user-item:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-xl);
            border-color: rgba(59, 130, 246, 0.3);
        }
        
        .user-info h3 {
            margin-bottom: 0.5rem;
            color: var(--text-primary);
            font-weight: 700;
            font-size: 1.125rem;
        }
        
        .user-info p {
            color: var(--text-secondary);
            font-size: 0.875rem;
            margin-bottom: 0.5rem;
            font-weight: 500;
        }
        
        .user-badge {
            padding: 0.375rem 0.875rem;
            border-radius: 100px;
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
            display: inline-block;
            margin-bottom: 0.5rem;
        }
        
        .badge-driver { 
            background: rgba(16, 185, 129, 0.15); 
            color: var(--success);
            border: 1px solid rgba(16, 185, 129, 0.3);
        }
        .badge-dispatcher { 
            background: rgba(245, 158, 11, 0.15); 
            color: var(--warning);
            border: 1px solid rgba(245, 158, 11, 0.3);
        }
        .badge-admin { 
            background: rgba(239, 68, 68, 0.15); 
            color: var(--danger);
            border: 1px solid rgba(239, 68, 68, 0.3);
        }
        
        .user-meta {
            font-size: 0.75rem;
            color: var(--text-muted);
            font-weight: 500;
        }
        
        .search-filters {
            display: flex;
            gap: 1.5rem;
            margin-bottom: 2rem;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .search-input {
            flex: 1;
            min-width: 300px;
            padding: 1rem 1.25rem;
            background: rgba(15, 23, 42, 0.8);
            border: 1px solid var(--border);
            border-radius: 12px;
            color: var(--text-primary);
            font-size: 0.875rem;
            font-weight: 500;
        }
        
        .search-input:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.1);
        }
        
        .message {
            padding: 1.25rem 1.75rem;
            border-radius: 16px;
            margin: 1.5rem 0;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .message.success {
            background: rgba(16, 185, 129, 0.15);
            color: var(--success);
            border: 1px solid rgba(16, 185, 129, 0.3);
        }
        
        .message.error {
            background: rgba(239, 68, 68, 0.15);
            color: var(--danger);
            border: 1px solid rgba(239, 68, 68, 0.3);
        }
        
        .loading-state {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 4rem;
            color: var(--text-muted);
            gap: 1.5rem;
        }
        
        .spinner {
            width: 28px; height: 28px;
            border: 3px solid var(--border);
            border-top: 3px solid var(--accent);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        .empty-state {
            text-align: center;
            padding: 4rem;
            color: var(--text-muted);
        }
        
        .empty-icon {
            font-size: 5rem;
            margin-bottom: 1.5rem;
            opacity: 0.3;
        }
        
        .empty-title {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 0.75rem;
            color: var(--text-secondary);
        }
        
        .sync-status {
            font-size: 0.875rem;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .sync-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--success);
            animation: pulse 2s infinite;
        }
        
        .sync-indicator.error {
            background: var(--danger);
            animation: none;
        }
        
        /* Control Panel */
        .control-panel {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            flex-wrap: wrap;
        }
        
        .filter-group {
            display: flex;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 10px;
            overflow: hidden;
        }
        
        .filter-btn {
            padding: 0.75rem 1.25rem;
            border: none;
            background: transparent;
            color: var(--text-secondary);
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
        }
        
        .filter-btn:not(:last-child) {
            border-right: 1px solid var(--border);
        }
        
        .filter-btn:hover {
            color: var(--text-primary);
            background: var(--bg-hover);
        }
        
        .filter-btn.active {
            color: white;
            background: var(--accent);
        }
        
        @media (max-width: 1400px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
        }
        
        @media (max-width: 768px) {
            .container { padding: 1rem; }
            .stats-grid { grid-template-columns: 1fr; }
            .form-grid { grid-template-columns: 1fr; }
            .header-content { flex-direction: column; gap: 1rem; }
            .header-actions { width: 100%; justify-content: space-between; }
            .search-filters { flex-direction: column; align-items: stretch; }
            .search-input { min-width: auto; }
            .control-panel { flex-direction: column; }
        }
    </style>
</head>
<body>
    <header class="top-header">
        <div class="header-content">
            <div class="brand">
                <div class="logo">‚ö°</div>
                <div class="brand-text">
                    <h1>FleetForce Enterprise</h1>
                    <p>Unified Command Center</p>
                </div>
            </div>
            <div class="header-actions">
                <div class="status-indicator" id="connectionStatus">
                    <div class="pulse"></div>
                    <span>System Operational</span>
                </div>
                <div class="current-time" id="currentTime">--:--:--</div>
            </div>
        </div>
    </header>
    
    <div class="container">
        <div class="nav-container">
            <nav class="nav-tabs">
                <button class="nav-tab active" onclick="switchTab('dashboard', this)">
                    <span>üìä</span>
                    <span>Live Dashboard</span>
                </button>
                <button class="nav-tab" onclick="switchTab('users', this)">
                    <span>üë•</span>
                    <span>Driver Management</span>
                </button>
                <button class="nav-tab" onclick="switchTab('reports', this)">
                    <span>üìà</span>
                    <span>Analytics</span>
                </button>
            </nav>
        </div>
        
        <!-- DASHBOARD TAB -->
        <div id="dashboard-tab" class="tab-content active">
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-icon">üë•</div>
                        <div class="stat-trend">Live</div>
                    </div>
                    <div class="stat-value" id="totalDrivers">0</div>
                    <div class="stat-label">Total Drivers</div>
                    <div class="stat-sublabel">Active in system</div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-icon">üöö</div>
                        <div class="stat-trend">Live</div>
                    </div>
                    <div class="stat-value" id="activeDrivers">0</div>
                    <div class="stat-label">Currently Active</div>
                    <div class="stat-sublabel">On duty today</div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-icon">üí§</div>
                        <div class="stat-trend">Live</div>
                    </div>
                    <div class="stat-value" id="standbyDrivers">0</div>
                    <div class="stat-label">On Standby</div>
                    <div class="stat-sublabel">Available for dispatch</div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-icon">üì°</div>
                        <div class="stat-trend">Live</div>
                    </div>
                    <div class="stat-value" id="lastSyncTime">--</div>
                    <div class="stat-label">Last Sync</div>
                    <div class="stat-sublabel">Data freshness</div>
                </div>
            </div>
            
            <!-- Control Panel -->
            <div class="control-panel">
                <div class="filter-group">
                    <button class="filter-btn active" onclick="filterDrivers('all', this)">All Drivers</button>
                    <button class="filter-btn" onclick="filterDrivers('active', this)">Active Only</button>
                    <button class="filter-btn" onclick="filterDrivers('standby', this)">Standby</button>
                </div>
                <button class="btn btn-secondary" onclick="refreshAllData()">
                    <span>üîÑ</span>
                    <span>Refresh Data</span>
                </button>
                <button class="btn btn-secondary" onclick="exportDriverData()">
                    <span>üìä</span>
                    <span>Export Report</span>
                </button>
            </div>
            
            <div class="dashboard-grid">
                <!-- Driver Activity Feed -->
                <div class="activity-section">
                    <div class="section-header">
                        <h2 class="section-title">
                            <span>üöõ</span>
                            <span>Driver Activity Feed</span>
                        </h2>
                        <div class="sync-status" id="syncStatus">
                            <div class="sync-indicator"></div>
                            <span>Real-time sync</span>
                        </div>
                    </div>
                    <div class="activity-list" id="activityList">
                        <div class="loading-state">
                            <div class="spinner"></div>
                            <span>Loading driver data...</span>
                        </div>
                    </div>
                </div>
                
                <!-- Quick Actions Panel -->
                <div>
                    <div class="card" style="margin-bottom: 1.5rem; padding: 1.5rem;">
                        <h3 style="color: var(--text-primary); margin-bottom: 1rem; font-size: 1.125rem;">
                            <span>‚ö°</span> Quick Actions
                        </h3>
                        
                        <div style="display: grid; gap: 0.75rem;">
                            <button class="btn btn-primary" onclick="switchToUsers()" style="width: 100%; justify-content: center;">
                                <span>üë§</span>
                                <span>Add New Driver</span>
                            </button>
                            <button class="btn btn-secondary" onclick="refreshAllData()" style="width: 100%; justify-content: center;">
                                <span>üîÑ</span>
                                <span>Refresh Data</span>
                            </button>
                            <button class="btn btn-success" onclick="exportDriverData()" style="width: 100%; justify-content: center;">
                                <span>üìä</span>
                                <span>Export Report</span>
                            </button>
                        </div>
                    </div>
                    
                    <div class="card" style="padding: 1.5rem;">
                        <h3 style="color: var(--text-primary); margin-bottom: 1rem; font-size: 1.125rem;">
                            <span>üìà</span> System Status
                        </h3>
                        
                        <div style="display: grid; gap: 1rem; font-size: 0.875rem;">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <span style="color: var(--text-secondary);">Database Status</span>
                                <span style="color: var(--success);" id="dbStatus">Connected</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <span style="color: var(--text-secondary);">API Response</span>
                                <span style="color: var(--success);" id="apiStatus">Healthy</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <span style="color: var(--text-secondary);">Auto-Refresh</span>
                                <span style="color: var(--accent);" id="refreshStatus">Active</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- USERS TAB -->
        <div id="users-tab" class="tab-content">
            <div class="card">
                <h2 class="card-title">
                    <span>üë§</span>
                    Driver Registration
                </h2>
                <p class="card-subtitle">Create and manage driver accounts with role-based access</p>
                
                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label" for="driverName">Full Name *</label>
                        <input type="text" id="driverName" class="form-input" placeholder="Enter driver's full name" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="driverEmail">Email Address</label>
                        <input type="email" id="driverEmail" class="form-input" placeholder="driver@company.com">
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="driverPhone">Phone Number</label>
                        <input type="tel" id="driverPhone" class="form-input" placeholder="+1 (555) 123-4567">
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="driverVehicle">Vehicle ID</label>
                        <input type="text" id="driverVehicle" class="form-input" placeholder="T-1234">
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="driverRole">Role</label>
                        <select id="driverRole" class="form-select">
                            <option value="driver">Driver</option>
                            <option value="dispatcher">Dispatcher</option>
                            <option value="admin">Administrator</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="driverPassword">Password</label>
                        <input type="password" id="driverPassword" class="form-input" placeholder="Secure password">
                    </div>
                </div>
                
                <button class="btn btn-primary" onclick="createDriver()">
                    <span class="loading-spinner"></span>
                    <span>‚úÖ</span>
                    <span>Create Driver Account</span>
                </button>
                <button class="btn btn-secondary" onclick="clearDriverForm()">
                    <span>üóëÔ∏è</span>
                    <span>Clear Form</span>
                </button>
                
                <div id="driverMessage"></div>
            </div>
            
            <div class="card">
                <h2 class="card-title">
                    <span>üë•</span>
                    Driver Directory
                </h2>
                <p class="card-subtitle">Comprehensive driver management and administration</p>
                
                <div class="search-filters">
                    <input type="text" class="search-input" id="searchDrivers" placeholder="Search drivers by name, email, or vehicle ID..." onkeyup="searchDrivers()">
                    <select id="roleFilter" class="form-select" style="width: auto; min-width: 180px;" onchange="filterByRole()">
                        <option value="all">All Roles</option>
                        <option value="driver">Drivers</option>
                        <option value="dispatcher">Dispatchers</option>
                        <option value="admin">Administrators</option>
                    </select>
                    <button class="btn btn-success" onclick="exportDriverData()">
                        <span>üìä</span>
                        <span>Export CSV</span>
                    </button>
                </div>
                
                <div id="driversList" class="users-list">
                    <div class="loading-state">
                        <div class="spinner"></div>
                        <span>Loading driver directory...</span>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- REPORTS TAB -->
        <div id="reports-tab" class="tab-content">
            <div class="card">
                <h2 class="card-title">
                    <span>üìà</span>
                    Analytics & Reports
                </h2>
                <p class="card-subtitle">Comprehensive fleet analytics and performance metrics</p>
                
                <div class="empty-state">
                    <div class="empty-icon">üìä</div>
                    <div class="empty-title">Advanced Analytics Coming Soon</div>
                    <p>Comprehensive reporting dashboard with real-time metrics, performance trends, and operational insights.</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global state
        let allDrivers = [];
        let filteredDrivers = [];
        let currentTab = 'dashboard';
        let currentFilter = 'all';
        let refreshInterval;
        
        // API configuration
        const API_BASE = window.location.origin;
        
        // Initialize application
        document.addEventListener('DOMContentLoaded', function() {
            console.log('FleetForce Enterprise - Unified System Initialized');
            startClock();
            loadAllData();
            startAutoRefresh();
        });
        
        // Clock management
        function startClock() {
            function updateTime() {
                const now = new Date();
                document.getElementById('currentTime').textContent = 
                    now.toLocaleTimeString('en-US', { hour12: false });
            }
            updateTime();
            setInterval(updateTime, 1000);
        }
        
        // Tab management
        function switchTab(tabName, buttonElement) {
            // Hide all tab contents
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // Remove active class from all nav tabs
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show selected tab and activate button
            setTimeout(() => {
                document.getElementById(tabName + '-tab').classList.add('active');
            }, 50);
            
            buttonElement.classList.add('active');
            currentTab = tabName;
            
            // Load relevant data for the tab
            if (tabName === 'dashboard' || tabName === 'users') {
                loadAllData();
            }
        }
        
        function switchToUsers() {
            const usersTabButton = document.querySelector('[onclick*="users"]');
            switchTab('users', usersTabButton);
        }
        
        // Data loading and management
        async function loadAllData() {
            try {
                updateConnectionStatus(true);
                console.log('Loading all driver data...');
                
                const response = await fetch(`${API_BASE}/api/users`);
                
                if (response.ok) {
                    const data = await response.json();
                    allDrivers = Array.isArray(data) ? data : (data.data || []);
                    
                    console.log(`Loaded ${allDrivers.length} drivers from database`);
                    
                    // Update filtered drivers based on current filter
                    applyCurrentFilter();
                    
                    // Update displays
                    updateDashboardStats();
                    updateDriversList();
                    updateActivityFeed();
                    
                    // Update sync status
                    updateSyncStatus(true);
                    document.getElementById('lastSyncTime').textContent = 
                        new Date().toLocaleTimeString();
                    
                } else {
                    throw new Error(`HTTP ${response.status}`);
                }
                
            } catch (error) {
                console.error('Failed to load data:', error);
                updateConnectionStatus(false);
                updateSyncStatus(false);
                showMessage('Failed to load driver data: ' + error.message, 'error');
            }
        }
        
        function updateConnectionStatus(connected) {
            const statusElement = document.getElementById('connectionStatus');
            const dbStatus = document.getElementById('dbStatus');
            const apiStatus = document.getElementById('apiStatus');
            
            if (connected) {
                statusElement.innerHTML = '<div class="pulse"></div><span>System Operational</span>';
                if (dbStatus) dbStatus.textContent = 'Connected';
                if (apiStatus) apiStatus.textContent = 'Healthy';
            } else {
                statusElement.innerHTML = '<div style="width: 10px; height: 10px; background: var(--danger); border-radius: 50%;"></div><span style="color: var(--danger);">Connection Failed</span>';
                if (dbStatus) dbStatus.textContent = 'Error';
                if (apiStatus) apiStatus.textContent = 'Failed';
            }
        }
        
        function updateSyncStatus(success) {
            const syncStatus = document.getElementById('syncStatus');
            if (syncStatus) {
                const indicator = syncStatus.querySelector('.sync-indicator');
                const text = syncStatus.querySelector('span');
                
                if (success) {
                    indicator.className = 'sync-indicator';
                    text.textContent = 'Real-time sync';
                } else {
                    indicator.className = 'sync-indicator error';
                    text.textContent = 'Sync failed';
                }
            }
        }
        
        // Dashboard functions
        function updateDashboardStats() {
            const totalDrivers = allDrivers.length;
            const activeDrivers = allDrivers.filter(d => d.active !== false && d.role === 'driver').length;
            const standbyDrivers = totalDrivers - activeDrivers;
            
            // Animate counters
            animateCounter('totalDrivers', totalDrivers);
            animateCounter('activeDrivers', activeDrivers);
            animateCounter('standbyDrivers', standbyDrivers);
        }
        
        function animateCounter(elementId, targetValue) {
            const element = document.getElementById(elementId);
            if (!element) return;
            
            const currentValue = parseInt(element.textContent) || 0;
            const increment = Math.ceil((targetValue - currentValue) / 20);
            
            if (currentValue === targetValue) return;
            
            const timer = setInterval(() => {
                const current = parseInt(element.textContent);
                const next = current + increment;
                
                if ((increment > 0 && next >= targetValue) || (increment < 0 && next <= targetValue)) {
                    element.textContent = targetValue;
                    clearInterval(timer);
                } else {
                    element.textContent = next;
                }
            }, 50);
        }
        
        function updateActivityFeed() {
            const activityList = document.getElementById('activityList');
            if (!activityList) return;
            
            if (filteredDrivers.length === 0) {
                activityList.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">üë•</div>
                        <div class="empty-title">No Drivers Found</div>
                        <p>Add drivers to see them in the activity feed</p>
                    </div>
                `;
                return;
            }
            
            // Sort drivers by creation date (newest first)
            const sortedDrivers = filteredDrivers
                .sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt))
                .slice(0, 20); // Show only latest 20
            
            activityList.innerHTML = sortedDrivers.map(driver => {
                const isActive = driver.active !== false && driver.role === 'driver';
                const timeAgo = getTimeAgo(new Date(driver.createdAt));
                
                return `
                    <div class="activity-item">
                        <div class="activity-content">
                            <div class="activity-info">
                                <div class="activity-driver">${driver.name}</div>
                                <div class="activity-details">
                                    <span>üìÖ Added ${timeAgo}</span>
                                    ${driver.email ? `<span>üìß ${driver.email}</span>` : ''}
                                    ${driver.vehicleId ? `<span>üöõ ${driver.vehicleId}</span>` : ''}
                                    <span>üë§ ${driver.role}</span>
                                </div>
                            </div>
                            <div style="display: flex; align-items: center; gap: 0.75rem;">
                                <span class="status-badge ${isActive ? 'status-active' : 'status-standby'}">
                                    ${isActive ? 'Active' : 'Standby'}
                                </span>
                                ${driver.role === 'driver' ? `
                                    <button class="btn btn-primary" style="padding: 0.5rem 1rem; font-size: 0.75rem;" 
                                            onclick="toggleDriverStatus('${driver._id}', ${!isActive})">
                                        ${isActive ? '‚è∏Ô∏è Deactivate' : '‚ñ∂Ô∏è Activate'}
                                    </button>
                                ` : ''}
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        function getTimeAgo(date) {
            const seconds = Math.floor((new Date() - date) / 1000);
            if (seconds < 60) return 'just now';
            const minutes = Math.floor(seconds / 60);
            if (minutes < 60) return `${minutes}m ago`;
            const hours = Math.floor(minutes / 60);
            if (hours < 24) return `${hours}h ago`;
            return `${Math.floor(hours / 24)}d ago`;
        }
        
        // Driver management functions
        async function createDriver() {
            const button = event.target;
            button.classList.add('loading');
            
            const name = document.getElementById('driverName').value.trim();
            const email = document.getElementById('driverEmail').value.trim();
            const phone = document.getElementById('driverPhone').value.trim();
            const vehicleId = document.getElementById('driverVehicle').value.trim();
            const role = document.getElementById('driverRole').value;
            const password = document.getElementById('driverPassword').value;
            
            if (!name) {
                showMessage('Driver name is required', 'error');
                button.classList.remove('loading');
                return;
            }
            
            const driverData = {
                name: name,
                role: role,
                active: true
            };
            
            // Only add fields if they have values
            if (email) driverData.email = email;
            if (phone) driverData.phoneNumber = phone;
            if (vehicleId) driverData.vehicleId = vehicleId;
            if (password) driverData.password = password;
            
            try {
                const response = await fetch(`${API_BASE}/api/users`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(driverData)
                });
                
                if (response.ok) {
                    showMessage(`Driver "${name}" created successfully`, 'success');
                    clearDriverForm();
                    loadAllData(); // Refresh all data
                } else {
                    const errorData = await response.json();
                    let errorMessage = errorData.error || 'Failed to create driver';
                    
                    // Handle specific errors
                    if (errorMessage.includes('duplicate key error') && errorMessage.includes('email')) {
                        errorMessage = 'Email address already exists. Please use a different email.';
                    }
                    
                    throw new Error(errorMessage);
                }
                
            } catch (error) {
                showMessage('Failed to create driver: ' + error.message, 'error');
            } finally {
                button.classList.remove('loading');
            }
        }
        
        function clearDriverForm() {
            document.getElementById('driverName').value = '';
            document.getElementById('driverEmail').value = '';
            document.getElementById('driverPhone').value = '';
            document.getElementById('driverVehicle').value = '';
            document.getElementById('driverRole').value = 'driver';
            document.getElementById('driverPassword').value = '';
        }
        
        async function deleteDriver(driverId, driverName) {
            if (!confirm(`Delete driver "${driverName}"?\n\nThis action cannot be undone.`)) return;
            
            try {
                const response = await fetch(`${API_BASE}/api/users/${driverId}`, { 
                    method: 'DELETE' 
                });
                
                if (response.ok) {
                    showMessage(`Driver "${driverName}" deleted successfully`, 'success');
                    loadAllData(); // Refresh all data
                } else {
                    throw new Error(`HTTP ${response.status}`);
                }
            } catch (error) {
                showMessage('Failed to delete driver: ' + error.message, 'error');
            }
        }
        
        async function toggleDriverStatus(driverId, newActiveStatus) {
            try {
                const response = await fetch(`${API_BASE}/api/users/${driverId}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ active: newActiveStatus })
                });
                
                if (response.ok) {
                    const driver = allDrivers.find(d => d._id === driverId);
                    if (driver) {
                        showMessage(`Driver "${driver.name}" ${newActiveStatus ? 'activated' : 'deactivated'}`, 'success');
                        loadAllData(); // Refresh all data
                    }
                } else {
                    throw new Error(`HTTP ${response.status}`);
                }
            } catch (error) {
                showMessage('Failed to update driver status: ' + error.message, 'error');
            }
        }
        
        function updateDriversList() {
            const driversList = document.getElementById('driversList');
            if (!driversList) return;
            
            if (filteredDrivers.length === 0) {
                driversList.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">üë•</div>
                        <div class="empty-title">No Drivers Found</div>
                        <p>Create your first driver account to get started</p>
                    </div>
                `;
                return;
            }
            
            driversList.innerHTML = filteredDrivers.map(driver => `
                <div class="user-item">
                    <div class="user-info">
                        <h3>${driver.name}</h3>
                        <p>${driver.email || 'No email provided'}</p>
                        ${driver.phoneNumber ? `<p>üìû ${driver.phoneNumber}</p>` : ''}
                        ${driver.vehicleId ? `<p>üöó ${driver.vehicleId}</p>` : ''}
                        <span class="user-badge badge-${driver.role}">${driver.role}</span>
                        <div class="user-meta">
                            Created: ${new Date(driver.createdAt).toLocaleDateString()} ‚Ä¢ 
                            Status: ${driver.active !== false ? 'Active' : 'Inactive'}
                        </div>
                    </div>
                    <div>
                        ${driver.role === 'driver' ? `
                            <button class="btn ${driver.active !== false ? 'btn-secondary' : 'btn-success'}" 
                                    onclick="toggleDriverStatus('${driver._id}', ${driver.active === false})"
                                    style="margin-right: 0.5rem;">
                                ${driver.active !== false ? '‚è∏Ô∏è Deactivate' : '‚ñ∂Ô∏è Activate'}
                            </button>
                        ` : ''}
                        <button class="btn btn-danger" onclick="deleteDriver('${driver._id}', '${driver.name.replace(/'/g, "\\'")}')">
                            üóëÔ∏è Delete
                        </button>
                    </div>
                </div>
            `).join('');
        }
        
        // Filter and search functions
        function applyCurrentFilter() {
            switch (currentFilter) {
                case 'active':
                    filteredDrivers = allDrivers.filter(d => d.active !== false && d.role === 'driver');
                    break;
                case 'standby':
                    filteredDrivers = allDrivers.filter(d => d.active === false || d.role !== 'driver');
                    break;
                default:
                    filteredDrivers = allDrivers.slice();
            }
        }
        
        function filterDrivers(filter, buttonElement) {
            currentFilter = filter;
            
            // Update button states
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            buttonElement.classList.add('active');
            
            // Apply filter and update displays
            applyCurrentFilter();
            updateDriversList();
            updateActivityFeed();
        }
        
        function searchDrivers() {
            const query = document.getElementById('searchDrivers').value.toLowerCase();
            const roleFilter = document.getElementById('roleFilter').value;
            
            filteredDrivers = allDrivers.filter(driver => {
                const matchesSearch = !query || 
                    driver.name.toLowerCase().includes(query) ||
                    (driver.email && driver.email.toLowerCase().includes(query)) ||
                    (driver.phoneNumber && driver.phoneNumber.includes(query)) ||
                    (driver.vehicleId && driver.vehicleId.toLowerCase().includes(query));
                
                const matchesRole = roleFilter === 'all' || driver.role === roleFilter;
                
                return matchesSearch && matchesRole;
            });
            
            updateDriversList();
            updateActivityFeed();
        }
        
        function filterByRole() {
            searchDrivers(); // Reuse search logic with role filter
        }
        
        // Utility functions
        function refreshAllData() {
            showMessage('Refreshing driver data...', 'success');
            loadAllData();
        }
        
        function exportDriverData() {
            if (allDrivers.length === 0) {
                showMessage('No drivers to export', 'error');
                return;
            }
            
            const csvData = [
                ['Name', 'Email', 'Phone', 'Role', 'Vehicle ID', 'Status', 'Created']
            ];
            
            allDrivers.forEach(driver => {
                csvData.push([
                    driver.name,
                    driver.email || '',
                    driver.phoneNumber || '',
                    driver.role,
                    driver.vehicleId || '',
                    driver.active !== false ? 'Active' : 'Inactive',
                    new Date(driver.createdAt).toLocaleDateString()
                ]);
            });
            
            const csv = csvData.map(row => 
                row.map(cell => `"${cell}"`).join(',')
            ).join('\n');
            
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `fleetforce-drivers-${new Date().toISOString().split('T')[0]}.csv`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
            
            showMessage(`Exported ${allDrivers.length} driver records`, 'success');
        }
        
        function showMessage(message, type) {
            const containers = ['driverMessage', 'dashboardMessage'];
            const icons = { success: '‚úÖ', error: '‚ùå', warning: '‚ö†Ô∏è' };
            
            containers.forEach(containerId => {
                const container = document.getElementById(containerId);
                if (container) {
                    container.innerHTML = `
                        <div class="message ${type}">
                            <span>${icons[type] || ''}</span>
                            <span>${message}</span>
                        </div>
                    `;
                    
                    // Auto-hide after 5 seconds
                    setTimeout(() => {
                        container.innerHTML = '';
                    }, 5000);
                }
            });
        }
        
        // Auto-refresh functionality
        function startAutoRefresh() {
            refreshInterval = setInterval(() => {
                loadAllData();
            }, 30000); // Refresh every 30 seconds
            
            // Update refresh status
            const refreshStatus = document.getElementById('refreshStatus');
            if (refreshStatus) {
                refreshStatus.textContent = 'Active (30s)';
            }
        }
        
        // Cleanup on page unload
        window.addEventListener('beforeunload', () => {
            if (refreshInterval) {
                clearInterval(refreshInterval);
            }
        });
    </script>
</body>
</html>
